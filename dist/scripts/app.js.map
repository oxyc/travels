{"version":3,"sources":["webpack:///./_resources/scripts/app.js","webpack:///./_resources/scripts/charts.js","webpack:///./_resources/scripts/commits.js","webpack:///./_resources/scripts/map.js","webpack:///./_resources/styles/abovefold.scss?8786","webpack:///./_resources/styles/app.scss?1199","webpack:///xmldom (ignored)"],"names":["charts","document","querySelectorAll","fetch","then","data","json","init","tooltipVisible","tagsHidden","templateExpenseTable","_","template","tripDate","tagTotalData","chartTypes","perTagCPD","el","options","duration","calculateTotalDuration","countryData","country","series","chain","groupBy","map","tagData","tag","amount","sumBy","row","transaction","parseInt","Math","round","name","y","value","Highcharts","chart","type","plotOptions","pie","allowPointSelect","dataLabels","enabled","showInLegend","events","click","event","point","expenses","filter","expense","tags","showExpenseTable","target","tooltip","valuePrefix","valueSuffix","pointFormat","title","text","perCountryCPD","countryList","countryDuration","getDateSpan","fill","Array","length","tagTotalAmount","each","countryIndex","indexOf","total","visible","isVisibleByDefault","redraw","axis","axes","removePlotLine","addPlotLine","getAveragePlotLine","xAxis","categories","yAxis","min","labels","format","stackLabels","style","color","fontWeight","textShadow","plotLines","legend","reversed","stacking","bar","category","element","tooltipInitalizer","tippyHideAll","exclude","_tippy","tippy","content","trigger","show","tripDuration","end","start","totalAmount","reduce","width","zIndex","id","keyBy","mapValues","dates","date","Date","earliestDate","now","latestDate","flatten","i","chartType","dataset","trip","tripData","expenditures","push","countries","innerHTML","addEventListener","getElementById","path","commit","L","Icon","Default","imagePath","mapbox","accessToken","MakiMarkers","AJAX_TIMEOUT","lMap","createMap","cluster","markerClusterGroup","maxClusterRadius","addTo","controls","markers","trek","icon","city","park","homebase","photo","size","visited","routeStyles","opacity","weight","route","tour","flight","boat","mouseover","preSelectedTrips","reject","trips","split","isEmpty","preSelectedCountries","leafletMeta","templateMarkerPopup","templateRoutePopup","openPopup","layer","hasLayer","_icon","__parent","zoomToShowLayer","_popup","pairs","array","slice","b","bindMarkerPopup","feature","properties","bindPopup","bindRoutePopup","distance","geometry","coordinates","pair","latLng","distanceTo","getMarkerIcon","latlng","key","toLowerCase","hasOwnProperty","marker","clone","getRouteStyle","selector","center","zoom","minZoom","maxZoom","scrollWheelZoom","tileLayer","Browser","retina","attribution","prepareLayers","groupOptions","collection","featureGroup","features","arcs","forEach","geoJson","topojson","parse","createControl","layers","control","collapsed","container","getContainer","DomUtil","addClass","touch","DomEvent","disableClickPropagation","disableScrollPropagation","toggleControlCheckboxes","onState","layerIds","_layers","pick","keys","inputs","_form","getElementsByTagName","l","input","String","layerId","checked","$","setTripLayerStyles","defaultStyle","setStyle","on","createSearchControl","Control","Search","propertyName","circleLocation","initial","autoCollapse","e","createCountryLayers","countryCollection","sort","a","countryLayers","onEachFeature","pointToLayer","dummyLayers","layerGroup","addLayer","countryControl","Util","stamp","overlay","index","removeLayer","createTripLayers","tripCollection","tripLayers","tripControl","promise","once","backgroundImage","debounce","getLayers","bounds","LatLngBounds","extend","getLatLng","fitBounds","addControl","Promise","allSettled","responses","idx","status","other","addOverlay"],"mappings":"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","file":"/scripts/app.js","sourcesContent":["import './map.js';\nimport './charts.js';\nimport './commits.js';","import _ from 'lodash';\nimport tippy from 'tippy.js';\nimport { hideAll as tippyHideAll } from 'tippy.js';\nimport Highcharts from 'highcharts';\n\nconst charts = document.querySelectorAll('.expenditure-chart');\nif (charts) {\n  fetch('/expenditures.json')\n    .then(data => data.json())\n    .then(init);\n}\n\nlet tooltipVisible = false;\n\nconst tagsHidden = ['flight', 'boat', 'tour'];\n\nconst templateExpenseTable = _.template(\n  '<table>' +\n  '<tr><th>Date</th><th>Amount</th><th>Description</th></tr>' +\n  '<% _.forEach(data, function (row) { %>' +\n  '<tr><td><%- row.date %><td>$<%- row.amount %></td><td><%- row.description || \"\" %></td></tr>' +\n  '<% }); %>' +\n  '</table>'\n);\n\nlet tripDate;\nconst tagTotalData = {};\n\nconst chartTypes = {\n  perTagCPD: (el, data, options) => {\n    let duration = calculateTotalDuration(options.countryData);\n    duration = duration[options.country];\n\n    const series = _.chain(data)\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        let amount = _.sumBy(row, (transaction) => parseInt(transaction.amount));\n        amount = Math.round(amount / duration * 100) / 100;\n        return {name: tag, y: amount};\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {type: 'pie'},\n      plotOptions: {\n        pie: {\n          allowPointSelect: true,\n          dataLabels: {enabled: false},\n          showInLegend: true,\n          events: {\n            click: (event) => {\n              const tag = event.point.name;\n              const expenses = _.filter(data, (expense) => expense.tags === tag);\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {\n        valuePrefix: '$',\n        valueSuffix: '/day',\n        pointFormat: '<b>{point.y} ({point.percentage:.1f}%)</b><br/>'\n      },\n      title: {text: options.title || ''},\n      series: [{name: 'Tags', data: series}]\n    });\n  },\n\n  perCountryCPD: (el, data, options) => {\n    // List of country names used as x-axis\n    const countryList = _.map(options.countryData, 'name');\n    // Calculate the duration in each country based on the dates.\n    // [{ name: 'country', dates: [{start: x, end: y}] }] => { country: 2 }\n    const countryDuration = calculateTotalDuration(options.countryData);\n    tripDate = getDateSpan(options.countryData);\n\n    // List of tags used as y-axis\n    const series = _.chain(data)\n      // Each tag has its own entry\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        // Create an array with an index for each country.\n        const countryData = _.fill(Array(countryList.length), 0);\n        let tagTotalAmount = 0;\n        _.chain(tagData)\n          .groupBy('country')\n          .each((row, country) => {\n            const countryIndex = _.indexOf(countryList, country);\n            const duration = countryDuration[country];\n            // Only add the data if we can calculate the cost per day.\n            if (duration) {\n              const total = _.sumBy(row, (transaction) => parseInt(transaction.amount));\n              tagTotalAmount += total;\n              countryData[countryIndex] = total / duration;\n              countryData[countryIndex] = Math.round(countryData[countryIndex] * 100) / 100;\n            }\n          })\n          .value();\n\n        tagTotalData[tag] = tagTotalAmount;\n\n        return {\n          name: tag,\n          visible: isVisibleByDefault(tag),\n          data: countryData\n        };\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {\n        type: 'bar',\n        events: {\n          redraw: () => {\n            var axis = this.axes[1];\n            axis.removePlotLine('plot-average');\n            axis.addPlotLine(getAveragePlotLine(axis.series));\n          }\n        }\n      },\n      xAxis: {categories: countryList},\n      yAxis: {\n        min: 0, title: {text: 'Cost per day'}, labels: {format: '${value}'},\n        stackLabels: {\n          enabled: true,\n          style: {color: '#999', fontWeight: 'normal', textShadow: 'none'}\n        },\n        plotLines: [getAveragePlotLine(series)]\n      },\n      legend: {reversed: true},\n      plotOptions: {\n        series: {stacking: 'normal'},\n        bar: {\n          events: {\n            click(event) {\n              const country = event.point.category;\n              const tag = this.name;\n              const expenses = _.filter(data, (expense) => {\n                return (expense.country === country && expense.tags === tag);\n              });\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {valuePrefix: '$'},\n      title: {text: options.title || ''},\n      series: series\n    });\n  }\n};\n\nfunction showExpenseTable(element, expenses) {\n  // Make this element distinquishable in the auto-close listener.\n  element.tooltipInitalizer = true;\n  tippyHideAll({exclude: element});\n  // @todo\n  const tooltip = element._tippy || tippy(element, {\n    content: templateExpenseTable({data: expenses}),\n    trigger: 'click',\n  });\n  tooltip.show();\n  tooltipVisible = true;\n}\n\nfunction isVisibleByDefault(tag) {\n  return tagsHidden.indexOf(tag) === -1;\n}\n\nfunction getAveragePlotLine(series) {\n  const tripDuration = (tripDate.end - tripDate.start) / 1000 / 3600 / 24 + 1;\n  const totalAmount = _.chain(series)\n    .filter('visible')\n    .reduce((total, series) => total + tagTotalData[series.name], 0)\n    .value();\n\n  return {\n    value: totalAmount / tripDuration,\n    color: 'red',\n    width: 2,\n    zIndex: 20,\n    id: 'plot-average'\n  };\n}\n\nfunction calculateTotalDuration(data) {\n  return _.chain(data)\n    .keyBy('name')\n    .mapValues(function (country) {\n      return _.reduce(country.dates, (total, date) => {\n        const start = new Date(date.start);\n        const end = new Date(date.end);\n        return total + (end - start) / 1000 / 3600 / 24 + 1;\n      }, 0);\n    })\n    .value();\n}\n\nfunction getDateSpan(data) {\n  let earliestDate = _.now();\n  let latestDate = 0;\n\n  _.chain(data)\n    .map('dates')\n    .flatten()\n    .each((date) => {\n      const start = new Date(date.start);\n      const end = new Date(date.end);\n      if (start < earliestDate) {\n        earliestDate = start;\n      }\n      if (end > latestDate) {\n        latestDate = end;\n      }\n    })\n    .value();\n\n  return {\n    start: earliestDate,\n    end: latestDate\n  };\n}\n\nfunction init(data) {\n  for (let i = 0; i < charts.length; i++) {\n    const el = charts[i];\n    const chartType = el.dataset.chart;\n    const options = {\n      trip: el.dataset.trip,\n      country: el.dataset.country,\n      title: el.dataset.title,\n      countryData: []\n    };\n    const tripData = _.chain(data.expenditures)\n      .filter('trip', options.trip)\n      .each((expenditures) => options.countryData.push(expenditures.countries))\n      .map('data')\n      .flatten()\n      .value();\n\n    // country dates should be merged really, but cant do it realiably as\n    // some might have dates but not expenditure entries.\n    options.countryData = _.chain(options.countryData)\n      .flatten(options.countryData)\n      .filter((country) => country.dates.length > 0)\n      .value();\n\n    if (options.country) {\n      tripData = _.filter(tripData, 'country', options.country);\n      options.countryData = _.filter(options.countryData, 'name', options.country);\n    }\n\n    if (!options.countryData.length) {\n      el.innerHTML = '<p><em>No data available yet</em></p>';\n      return;\n    }\n\n    chartTypes[chartType](el, tripData, options);\n  }\n\n  document.addEventListener('click', (event) => {\n    if (!tooltipVisible || (event.target && event.target.tooltipInitalizer)) {\n      return;\n    }\n    tippyHideAll();\n    tooltipVisible = false;\n  });\n}\n","const el = document.getElementById('commit-history');\nif (el) {\n  const path = 'https://api.github.com/repos/oxyc/travels/commits';\n  const template = _.template(\n    '<li><a href=\"<%- html_url %>\"><span class=\"date\"><%- new Date(commit.author.date).toDateString() %></span> <%- commit.message %></li>'\n  );\n\n  fetch(path)\n    .then(data => data.json())\n    .then((data) => {\n      const content = _.reduce(data, function (content, commit) {\n        return content + template(commit);\n      }, '');\n      el.innerHTML = content;\n    });\n}","import _ from 'lodash';\nimport L from 'leaflet';\nimport { topojson } from '@mapbox/leaflet-omnivore';\nimport 'leaflet.markercluster';\nimport 'leaflet-makimarkers';\nimport 'leaflet-search';\n\nL.Icon.Default.imagePath = '/dist/images';\nL.mapbox = L.mapbox || {};\nL.mapbox.accessToken = 'pk.eyJ1Ijoib3h5IiwiYSI6InBMaXRxSDAifQ.w9NqRLivEBn6BoMRkKmg3A';\nL.MakiMarkers.accessToken = L.mapbox.accessToken;\n\n// Short timeout as some geojson files might not exist yet.\nconst AJAX_TIMEOUT = 5000;\n\nexport const lMap = createMap('world-map');\nexport const cluster = L.markerClusterGroup({maxClusterRadius: 20}).addTo(lMap);\nexport const controls = {};\n\nexport const markers = {\n  trek: {icon: 'campsite', color: '#159957'},\n  city: {icon: 'circle', color: '#659CD6'},\n  park: {icon: 'park', color: '#159957'},\n  homebase: {icon: 'building', color: '#D85E5E'},\n  photo: {icon: 'camera', color: '#659CD6', size: 's'},\n  visited: {color: '#659CD6'}\n};\n\nexport const routeStyles = {\n  trek: {color: '#159957', opacity: 1, weight: 5},\n  route: {color: '#000', opacity: 1, weight: 2},\n  tour: {color: '#000', opacity: 1, weight: 2},\n  flight: {color: '#000', opacity: 0.3, weight: 2},\n  boat: {color: '#2057D0', opacity: 0.3, weight: 2},\n  mouseover: {color: '#ff0000', opacity: 0.7, weight: 3}\n};\n\nconst map = document.getElementById('world-map');\n\nconst preSelectedTrips = _.reject(map.dataset.trips.split(' ') || [], _.isEmpty);\nconst preSelectedCountries = _.reject(map.dataset.country.split(' ') || [], _.isEmpty);\nconst leafletMeta = {};\n\n// Initialize\nfetch('/world.json')\n  .then(data => data.json())\n  .then(init);\n\nconst templateMarkerPopup = _.template(\n  '<strong><%- name %>, <%- _.startCase(country) %></strong> <small><%- type %></small><br>' +\n  '<% if (!visited) { %><em>planning to visit</em><br><% } %>' +\n  '<% if (typeof homebase !== \"undefined\" && homebase) { %><em>I used to live here</em><% } %>' +\n  '<% if (typeof description !== \"undefined\") { %><span class=\"description\"><%- description %></span><% } %>'\n);\nconst templateRoutePopup = _.template(\n  '<strong><%- name %></strong> <small><%- type %></small><br>' +\n  'Distance: <%- Math.round(distance / 1000) %> km'\n);\n\nexport function openPopup(layer) {\n  // Exit if the layer isnt visible\n  if (!cluster.hasLayer(layer) || (!layer._icon && !layer.__parent._icon)) {\n    return false;\n  }\n  cluster.zoomToShowLayer(layer, () => {\n    if (layer._popup) {\n      layer.openPopup();\n    }\n  });\n};\n\nfunction pairs(array) {\n  return array.slice(1).map((b, i) => [array[i], b]);\n}\n\nfunction bindMarkerPopup(feature, layer) {\n  const content = templateMarkerPopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction bindRoutePopup(feature, layer) {\n  feature.properties.distance = _.reduce(pairs(feature.geometry.coordinates), (total, pair) => {\n    return total + L.latLng(pair[0][1], pair[0][0])\n      .distanceTo(L.latLng(pair[1][1], pair[1][0]));\n  }, 0);\n  const content = templateRoutePopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction getMarkerIcon(feature, latlng) {\n  let key = feature.properties.type.toLowerCase();\n  if (feature.properties.homebase) {\n    key = 'homebase';\n  } else if (['national park', 'nature reserve'].indexOf(key) !== -1) {\n    key = 'park';\n  } else if (!markers.hasOwnProperty(key)) {\n    key = 'visited';\n  }\n\n  let marker = markers[key];\n  if (!feature.properties.visited) {\n    marker = _.clone(marker);\n    marker.color = '#999';\n  }\n\n  return L.marker(latlng, {icon: L.MakiMarkers.icon(marker)});\n}\n\nfunction getRouteStyle(feature) {\n  return routeStyles[feature.properties.type.toLowerCase()];\n}\n\nfunction createMap(selector) {\n  const map = L.map(selector, {\n    center: [18, 0],\n    zoom: 2,\n    minZoom: 2,\n    maxZoom: 10,\n    scrollWheelZoom: false\n  });\n\n  L.tileLayer('https://api.mapbox.com/v4/{id}/{z}/{x}/{y}' + (L.Browser.retina ? '@2x' : '') + '.png?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'oxy.ndp8318l',\n    accessToken: L.mapbox.accessToken,\n  }).addTo(map);\n\n  return map;\n}\n\nfunction prepareLayers(type, data, groupOptions) {\n  const collection = _.chain(data)\n    // If it's TopoJson require that there be arcs.\n    .filter((featureGroup) => {\n      return featureGroup.features.type !== 'Topology' || featureGroup.features.arcs.length;\n    })\n    .forEach((featureGroup) => {\n      if (featureGroup.features.type === 'Topology') {\n        var layer = L.geoJson(null, groupOptions);\n        featureGroup.layer = topojson.parse(featureGroup.features, null, layer);\n      } else {\n        featureGroup.layer = L.geoJson(featureGroup.features, groupOptions);\n      }\n      featureGroup.layer.type = type;\n      featureGroup.layer.id = featureGroup.properties.id;\n    })\n    .keyBy((featureGroup) => featureGroup.properties.name)\n    .value();\n\n  return _.mapValues(collection, 'layer');\n}\n\nfunction createControl(type, layers) {\n  const control = L.control.layers(null, layers, {collapsed: true}).addTo(lMap);\n  // Add custom classes to the leaflet control\n  const container = control.getContainer();\n  L.DomUtil.addClass(container, 'control-custom');\n  L.DomUtil.addClass(container, 'control-' + type);\n\n  if (!L.Browser.touch) {\n    L.DomEvent\n      .disableClickPropagation(container)\n      .disableScrollPropagation(container);\n  } else {\n    L.DomEvent.disableClickPropagation(container);\n  }\n  return control;\n}\n\nfunction toggleControlCheckboxes(control, labels, onState) {\n  // List of the layer ids corresponding the the listed labels (strings).\n  const layerIds = _.chain(control._layers)\n    .pick((layer) => labels.indexOf(layer.layer.id) !== -1)\n    .keys()\n    .value();\n\n  // Iterate over all the checkboxes in the controls form,\n  const inputs = control._form.getElementsByTagName('input');\n  for (let i = 0, l = inputs.length; i < l; i++) {\n    let input = inputs[i];\n    // Skip checkboxes for countries not part of this trip.\n    if (layerIds.indexOf(String(input.layerId)) === -1) {\n      continue;\n    }\n    // The checkbox is already checked.\n    if (onState && input.checked) {\n      continue;\n    }\n    // The checkbox is already unchecked.\n    if (!onState && !input.checked) {\n      continue;\n    }\n    // Trigger a click so that Leaflet acts on it and triggers this\n    // same event but for each country.\n    $(input).trigger('click');\n  }\n}\n\nfunction setTripLayerStyles(feature, layer) {\n  const defaultStyle = getRouteStyle(feature);\n  bindRoutePopup(feature, layer);\n  layer.setStyle(defaultStyle);\n\n  (function () { // @todo\n    layer.on('mouseover', () => layer.setStyle(routeStyles.mouseover));\n    layer.on('mouseout', () => layer.setStyle(defaultStyle));\n  })();\n}\n\nfunction createSearchControl() {\n  const control = new L.Control.Search({\n    layer: cluster,\n    propertyName: 'name',\n    circleLocation: false,\n    initial: false,\n    autoCollapse: true,\n    zoom: 10\n  });\n\n  control.on('search_locationfound', (e) => openPopup(e.layer));\n  return control;\n}\n\nfunction createCountryLayers(countryCollection) {\n  countryCollection = countryCollection.sort((a, b) => {\n    if (a.properties.id < b.properties.id) {\n      return -1;\n    }\n    if (a.properties.id > b.properties.id) {\n      return 1;\n    }\n    return 0;\n  });\n  // The real layers\n  const countryLayers = prepareLayers('country', countryCollection, {onEachFeature: bindMarkerPopup, pointToLayer: getMarkerIcon});\n  // @see https://github.com/Leaflet/Leaflet.markercluster/issues/13\n  // Create dummy layers without markers. When these are clicked, the\n  // corresponding real layer will be added/removed to the\n  // MarkerClusterGroup.\n  const dummyLayers = {};\n  _.forEach(countryLayers, (layer, name) => {\n    dummyLayers[name] = L.layerGroup();\n    dummyLayers[name].type = 'country';\n    dummyLayers[name].id = layer.id;\n    // If a pre-selected country is defiend, exit here so that it's not\n    // preselected.\n    if (preSelectedCountries.length && preSelectedCountries.indexOf(layer.id) === -1) {\n      return;\n    }\n    // Dummy layer is attached to Map\n    dummyLayers[name].addTo(lMap);\n    // Real layer is attached to MarkerClusterGroup\n    cluster.addLayer(layer);\n  });\n\n  // Controls point the the dummy layers.\n  const countryControl = controls.country = createControl('country', dummyLayers);\n  // Add a mapping so that we can find the real layer alter.\n  for (let row in countryControl._layers) {\n    if (countryControl._layers.hasOwnProperty(row)) {\n      leafletMeta[L.Util.stamp(countryControl._layers[row].layer)] = countryControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', (overlay) => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'country') {\n      return;\n    }\n\n    if (overlay.type === 'overlayadd') {\n      cluster.addLayer(countryLayers[index]);\n    } else {\n      cluster.removeLayer(countryLayers[index]);\n    }\n  });\n\n  return countryLayers;\n}\n\nfunction createTripLayers(tripCollection) {\n  const tripLayers = prepareLayers('trip', tripCollection, {onEachFeature: setTripLayerStyles});\n  if (!preSelectedCountries.length) {\n    _.forEach(tripLayers, (layer) => layer.addTo(lMap));\n  }\n  const tripControl = controls.trip = createControl('trip', tripLayers);\n\n  for (let row in tripControl._layers) {\n    if (tripControl._layers.hasOwnProperty(row)) {\n      leafletMeta[L.Util.stamp(tripControl._layers[row].layer)] = tripControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', (overlay) => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'trip') {\n      return;\n    }\n    const trip = tripCollection[index];\n    const countries = _.map(trip.properties.countries, 'name');\n    const control = controls.country;\n    const on = (overlay.type === 'overlayadd');\n\n    toggleControlCheckboxes(control, countries, on);\n  });\n\n  if (preSelectedTrips.length) {\n    _.chain(tripLayers)\n      .pick((layer) => preSelectedTrips.indexOf(layer.id) === -1)\n      .forEach((layer) => lMap.removeLayer(layer))\n      .value();\n\n    _.chain(tripLayers)\n      .pick((layer) => preSelectedTrips.indexOf(layer.id) !== -1)\n      .forEach((layer) => {\n        lMap.removeLayer(layer);\n        lMap.addLayer(layer);\n      })\n      .value();\n  }\n}\n\nfunction init(data) {\n  // Issue XHR requests for the routes of all trips, but do it async while\n  // rendering regular markers.\n  let tripCollection = _.forEach(data.trips, (trip) => {\n    trip.promise = fetch(`/${trip.path}`);\n  });\n\n  // Remove the placeholder image as it gets displayed while tiles are\n  // fetched.\n  lMap.once('zoomstart', () => map.style.backgroundImage = 'none');\n\n  lMap.on('overlayadd overlayremove', _.debounce((event) => {\n    if (event.layer.type && event.layer.type === 'country') {\n      const layers = cluster.getLayers();\n      if (!layers.length) {\n        return;\n      }\n      const bounds = new L.LatLngBounds();\n      for (let i = 0, l = layers.length; i < l; i++) {\n        bounds.extend(layers[i].getLatLng());\n      }\n      lMap.fitBounds(bounds);\n    }\n  }, 100));\n\n  // Create the country layers.\n  createCountryLayers(data.countries);\n  lMap.addControl(createSearchControl());\n\n  // Wait for all requests to finish\n  Promise.allSettled(_.map(tripCollection, (trip) => {\n    return trip.promise.then(data => data.json());\n  })).then((responses) => {\n    tripCollection = _.chain(tripCollection)\n      // Filter out failed requests.\n      .filter((trip, idx) => responses[idx].status === 'fulfilled')\n      // Attach the features collected from the XHR request.\n      .forEach((trip, idx) => trip.features = responses[idx].value)\n      .keyBy((trip) => trip.properties.name)\n      .value();\n\n    // Create the trip layers.\n    createTripLayers(tripCollection);\n\n    if (!controls.other) {\n      controls.other = L.control.layers(null, null, {collapsed: false}).addTo(lMap);\n      controls.other.addOverlay(cluster, 'Markers');\n    }\n  });\n}","// removed by extract-text-webpack-plugin","// removed by extract-text-webpack-plugin","/* (ignored) */"],"sourceRoot":""}