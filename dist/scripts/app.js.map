{"version":3,"sources":["webpack:///./_resources/scripts/app.js","webpack:///./_resources/scripts/charts.js","webpack:///./_resources/scripts/commits.js","webpack:///./_resources/scripts/map.js","webpack:///./_resources/styles/abovefold.scss?8786","webpack:///./_resources/styles/app.scss?1199","webpack:///xmldom (ignored)"],"names":["charts","document","querySelectorAll","fetch","then","data","json","init","tooltipVisible","tagsHidden","templateExpenseTable","_","template","tripDate","tagTotalData","chartTypes","perTagCPD","el","options","duration","calculateTotalDuration","countryData","country","series","chain","filter","entry","groupBy","map","tagData","tag","amount","sumBy","transaction","parseInt","Math","round","name","y","value","Highcharts","chart","type","plotOptions","pie","allowPointSelect","dataLabels","enabled","showInLegend","events","click","event","point","expenses","expense","tags","showExpenseTable","target","tooltip","valuePrefix","valueSuffix","pointFormat","title","text","perCountryCPD","countryList","countryDuration","getDateSpan","fill","Array","length","tagTotalAmount","each","row","countryIndex","indexOf","total","visible","isVisibleByDefault","redraw","axis","axes","removePlotLine","addPlotLine","getAveragePlotLine","xAxis","categories","yAxis","min","labels","format","stackLabels","style","color","fontWeight","textShadow","plotLines","legend","reversed","stacking","bar","category","element","tooltipInitalizer","tippyHideAll","exclude","_tippy","tippy","content","trigger","show","includes","tripDuration","end","start","totalAmount","reduce","width","zIndex","id","keyBy","mapValues","dates","date","Date","earliestDate","now","latestDate","flatten","chartType","dataset","trip","tripData","expenditures","push","countries","innerHTML","addEventListener","querySelector","path","commit","L","Icon","Default","imagePath","mapbox","accessToken","MakiMarkers","lMap","createMap","cluster","markerClusterGroup","maxClusterRadius","addTo","controls","markers","trek","icon","city","park","homebase","photo","size","visited","routeStyles","opacity","weight","route","tour","flight","boat","mouseover","preSelectedTrips","reject","trips","split","isEmpty","preSelectedCountries","leafletMeta","templateMarkerPopup","templateRoutePopup","openPopup","layer","hasLayer","_icon","__parent","zoomToShowLayer","_popup","pairs","array","slice","b","i","bindMarkerPopup","feature","properties","bindPopup","bindRoutePopup","distance","geometry","coordinates","pair","latLng","distanceTo","getMarkerIcon","latlng","key","toLowerCase","marker","clone","getRouteStyle","selector","center","zoom","minZoom","maxZoom","scrollWheelZoom","tileLayer","Browser","retina","attribution","prepareLayers","groupOptions","collection","featureGroup","features","arcs","forEach","geoJson","topojson","parse","createControl","layers","control","collapsed","container","getContainer","DomUtil","addClass","touch","DomEvent","disableClickPropagation","disableScrollPropagation","toggleControlCheckboxes","onState","layerIds","_layers","pick","keys","inputs","_layerControlInputs","l","input","String","layerId","checked","setTripLayerStyles","defaultStyle","setStyle","on","createSearchControl","Control","Search","propertyName","circleLocation","initial","autoCollapse","e","createCountryLayers","countryCollection","sort","a","countryLayers","onEachFeature","pointToLayer","dummyLayers","layerGroup","addLayer","countryControl","Util","stamp","overlay","index","removeLayer","createTripLayers","tripCollection","tripLayers","tripControl","console","log","promise","once","backgroundImage","debounce","getLayers","bounds","LatLngBounds","extend","getLatLng","fitBounds","addControl","Promise","all","error","responses","idx","other","addOverlay"],"mappings":"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","file":"/scripts/app.js","sourcesContent":["import './map';\nimport './charts';\nimport './commits';\n","import _ from 'lodash';\nimport tippy, {hideAll as tippyHideAll} from 'tippy.js';\nimport Highcharts from 'highcharts';\n\nconst charts = document.querySelectorAll('.expenditure-chart');\nif (charts) {\n  fetch('/expenditures.json')\n    .then(data => data.json())\n    .then(init);\n}\n\nlet tooltipVisible = false;\n\nconst tagsHidden = ['flight', 'boat', 'tour'];\n\nconst templateExpenseTable = _.template(\n  '<table>' +\n  '<tr><th>Date</th><th>Amount</th><th>Description</th></tr>' +\n  '<% _.forEach(data, function (row) { %>' +\n  '<tr><td><%- row.date %><td>$<%- row.amount %></td><td><%- row.description || \"\" %></td></tr>' +\n  '<% }); %>' +\n  '</table>'\n);\n\nlet tripDate;\nconst tagTotalData = {};\n\nconst chartTypes = {\n  perTagCPD: (el, data, options) => {\n    let duration = calculateTotalDuration(options.countryData);\n    duration = duration[options.country];\n\n    const series = _.chain(data)\n      .filter(entry => entry.country === options.country)\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        let amount = _.sumBy(tagData, transaction => parseInt(transaction.amount, 10));\n        amount = Math.round(amount / duration * 100) / 100;\n        return {name: tag, y: amount};\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {type: 'pie'},\n      plotOptions: {\n        pie: {\n          allowPointSelect: true,\n          dataLabels: {enabled: false},\n          showInLegend: true,\n          events: {\n            click: event => {\n              const tag = event.point.name;\n              const expenses = _.filter(data, expense => expense.tags === tag);\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {\n        valuePrefix: '$',\n        valueSuffix: '/day',\n        pointFormat: '<b>{point.y} ({point.percentage:.1f}%)</b><br/>'\n      },\n      title: {text: options.title || ''},\n      series: [{name: 'Tags', data: series}]\n    });\n  },\n\n  perCountryCPD: (el, data, options) => {\n    // List of country names used as x-axis\n    const countryList = _.map(options.countryData, 'name');\n    // Calculate the duration in each country based on the dates.\n    // [{ name: 'country', dates: [{start: x, end: y}] }] => { country: 2 }\n    const countryDuration = calculateTotalDuration(options.countryData);\n    tripDate = getDateSpan(options.countryData);\n\n    // List of tags used as y-axis\n    const series = _.chain(data)\n      // Each tag has its own entry\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        // Create an array with an index for each country.\n        const countryData = _.fill(new Array(countryList.length), 0);\n        let tagTotalAmount = 0;\n        _.chain(tagData)\n          .groupBy('country')\n          .each((row, country) => {\n            const countryIndex = _.indexOf(countryList, country);\n            const duration = countryDuration[country];\n            // Only add the data if we can calculate the cost per day.\n            if (duration) {\n              const total = _.sumBy(row, transaction => parseInt(transaction.amount, 10));\n              tagTotalAmount += total;\n              countryData[countryIndex] = total / duration;\n              countryData[countryIndex] = Math.round(countryData[countryIndex] * 100) / 100;\n            }\n          })\n          .value();\n\n        tagTotalData[tag] = tagTotalAmount;\n\n        return {\n          name: tag,\n          visible: isVisibleByDefault(tag),\n          data: countryData\n        };\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {\n        type: 'bar',\n        events: {\n          redraw: () => {\n            const axis = this.axes[1];\n            axis.removePlotLine('plot-average');\n            axis.addPlotLine(getAveragePlotLine(axis.series));\n          }\n        }\n      },\n      xAxis: {categories: countryList},\n      yAxis: {\n        min: 0,\n        title: {text: 'Cost per day'},\n        labels: {format: '${value}'}, /* eslint no-template-curly-in-string:off */\n        stackLabels: {\n          enabled: true,\n          style: {color: '#999', fontWeight: 'normal', textShadow: 'none'}\n        },\n        plotLines: [getAveragePlotLine(series)]\n      },\n      legend: {reversed: true},\n      plotOptions: {\n        series: {stacking: 'normal'},\n        bar: {\n          events: {\n            click(event) {\n              const country = event.point.category;\n              const tag = this.name;\n              const expenses = _.filter(data, expense => {\n                return (expense.country === country && expense.tags === tag);\n              });\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {valuePrefix: '$'},\n      title: {text: options.title || ''},\n      series\n    });\n  }\n};\n\nfunction showExpenseTable(element, expenses) {\n  // Make this element distinquishable in the auto-close listener.\n  element.tooltipInitalizer = true;\n  tippyHideAll({exclude: element});\n  // @todo\n  const tooltip = element._tippy || tippy(element, {\n    content: templateExpenseTable({data: expenses}),\n    trigger: 'click'\n  });\n  tooltip.show();\n  tooltipVisible = true;\n}\n\nfunction isVisibleByDefault(tag) {\n  return !tagsHidden.includes(tag);\n}\n\nfunction getAveragePlotLine(series) {\n  const tripDuration = ((tripDate.end - tripDate.start) / 1000 / 3600 / 24) + 1;\n  const totalAmount = _.chain(series)\n    .filter('visible')\n    .reduce((total, series) => total + tagTotalData[series.name], 0)\n    .value();\n\n  return {\n    value: totalAmount / tripDuration,\n    color: 'red',\n    width: 2,\n    zIndex: 20,\n    id: 'plot-average'\n  };\n}\n\nfunction calculateTotalDuration(data) {\n  return _.chain(data)\n    .keyBy('name')\n    .mapValues(country => {\n      return _.reduce(country.dates, (total, date) => {\n        const start = new Date(date.start);\n        const end = new Date(date.end);\n        return total + ((end - start) / 1000 / 3600 / 24) + 1;\n      }, 0);\n    })\n    .value();\n}\n\nfunction getDateSpan(data) {\n  let earliestDate = _.now();\n  let latestDate = 0;\n\n  _.chain(data)\n    .map('dates')\n    .flatten()\n    .each(date => {\n      const start = new Date(date.start);\n      const end = new Date(date.end);\n      if (start < earliestDate) {\n        earliestDate = start;\n      }\n\n      if (end > latestDate) {\n        latestDate = end;\n      }\n    })\n    .value();\n\n  return {\n    start: earliestDate,\n    end: latestDate\n  };\n}\n\nfunction init(data) {\n  for (const el of charts) {\n    const chartType = el.dataset.chart;\n    const options = {\n      trip: el.dataset.trip,\n      country: el.dataset.country,\n      title: el.dataset.title,\n      countryData: []\n    };\n\n    let tripData = _.chain(data.expenditures)\n      .filter('trip', options.trip)\n      .each(expenditures => options.countryData.push(expenditures.countries))\n      .map('data')\n      .flatten()\n      .value();\n\n    // Country dates should be merged really, but cant do it reliably as\n    // some might have dates but not expenditure entries.\n    options.countryData = _.chain(options.countryData)\n      .flatten(options.countryData)\n      .filter(country => country.dates.length > 0)\n      .value();\n\n    if (options.country) {\n      tripData = _.filter(tripData, 'country', options.country);\n      options.countryData = _.filter(options.countryData, 'name', options.country);\n    }\n\n    if (options.countryData.length === 0) {\n      el.innerHTML = '<p><em>No data available yet</em></p>';\n\n      return;\n    }\n\n    chartTypes[chartType](el, tripData, options);\n  }\n\n  document.addEventListener('click', event => {\n    if (!tooltipVisible || (event.target && event.target.tooltipInitalizer)) {\n      return;\n    }\n\n    tippyHideAll();\n    tooltipVisible = false;\n  });\n}\n","import _ from 'lodash';\n\nconst el = document.querySelector('#commit-history');\nif (el) {\n  const path = 'https://api.github.com/repos/oxyc/travels/commits';\n  const template = _.template(\n    '<li><a href=\"<%- html_url %>\"><span class=\"date\"><%- new Date(commit.author.date).toDateString() %></span> <%- commit.message %></li>'\n  );\n\n  fetch(path)\n    .then(data => data.json())\n    .then(data => {\n      const content = _.reduce(data, (content, commit) => {\n        return content + template(commit);\n      }, '');\n      el.innerHTML = content;\n    });\n}\n","import _ from 'lodash';\nimport L from 'leaflet';\nimport {topojson} from '@mapbox/leaflet-omnivore';\nimport 'leaflet.markercluster';\nimport 'leaflet-makimarkers';\nimport 'leaflet-search';\n\nL.Icon.Default.imagePath = '/dist/images';\nL.mapbox = L.mapbox || {};\nL.mapbox.accessToken = 'pk.eyJ1Ijoib3h5IiwiYSI6InBMaXRxSDAifQ.w9NqRLivEBn6BoMRkKmg3A';\nL.MakiMarkers.accessToken = L.mapbox.accessToken;\n\nexport const lMap = createMap('world-map');\nexport const cluster = L.markerClusterGroup({maxClusterRadius: 20}).addTo(lMap);\nexport const controls = {};\n\nexport const markers = {\n  trek: {icon: 'campsite', color: '#159957'},\n  city: {icon: 'circle', color: '#659CD6'},\n  park: {icon: 'park', color: '#159957'},\n  homebase: {icon: 'building', color: '#D85E5E'},\n  photo: {icon: 'camera', color: '#659CD6', size: 's'},\n  visited: {color: '#659CD6'}\n};\n\nexport const routeStyles = {\n  trek: {color: '#159957', opacity: 1, weight: 5},\n  route: {color: '#000', opacity: 1, weight: 2},\n  tour: {color: '#000', opacity: 1, weight: 2},\n  flight: {color: '#000', opacity: 0.3, weight: 2},\n  boat: {color: '#2057D0', opacity: 0.3, weight: 2},\n  mouseover: {color: '#ff0000', opacity: 0.7, weight: 3}\n};\n\nconst map = document.querySelector('#world-map');\n\nconst preSelectedTrips = _.reject(map.dataset.trips.split(' ') || [], _.isEmpty);\nconst preSelectedCountries = _.reject(map.dataset.country.split(' ') || [], _.isEmpty);\nconst leafletMeta = {};\n\n// Initialize\nfetch('/world.json')\n  .then(data => data.json())\n  .then(init);\n\nconst templateMarkerPopup = _.template(\n  '<strong><%- name %>, <%- _.startCase(country) %></strong> <small><%- type %></small><br>' +\n  '<% if (!visited) { %><em>planning to visit</em><br><% } %>' +\n  '<% if (typeof homebase !== \"undefined\" && homebase) { %><em>I used to live here</em><% } %>' +\n  '<% if (typeof description !== \"undefined\") { %><span class=\"description\"><%- description %></span><% } %>'\n);\nconst templateRoutePopup = _.template(\n  '<strong><%- name %></strong> <small><%- type %></small><br>' +\n  'Distance: <%- Math.round(distance / 1000) %> km'\n);\n\nexport function openPopup(layer) {\n  // Exit if the layer isnt visible\n  if (!cluster.hasLayer(layer) || (!layer._icon && !layer.__parent._icon)) {\n    return false;\n  }\n\n  cluster.zoomToShowLayer(layer, () => {\n    if (layer._popup) {\n      layer.openPopup();\n    }\n  });\n}\n\nfunction pairs(array) {\n  return array.slice(1).map((b, i) => [array[i], b]);\n}\n\nfunction bindMarkerPopup(feature, layer) {\n  const content = templateMarkerPopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction bindRoutePopup(feature, layer) {\n  feature.properties.distance = _.reduce(pairs(feature.geometry.coordinates), (total, pair) => {\n    return total + L.latLng(pair[0][1], pair[0][0])\n      .distanceTo(L.latLng(pair[1][1], pair[1][0]));\n  }, 0);\n\n  const content = templateRoutePopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction getMarkerIcon(feature, latlng) {\n  let key = feature.properties.type.toLowerCase();\n  if (feature.properties.homebase) {\n    key = 'homebase';\n  } else if (['national park', 'nature reserve'].includes(key)) {\n    key = 'park';\n  } else if (!markers[key]) {\n    key = 'visited';\n  }\n\n  let marker = markers[key];\n  if (!feature.properties.visited) {\n    marker = _.clone(marker);\n    marker.color = '#999';\n  }\n\n  return L.marker(latlng, {icon: L.MakiMarkers.icon(marker)});\n}\n\nfunction getRouteStyle(feature) {\n  return routeStyles[feature.properties.type.toLowerCase()];\n}\n\nfunction createMap(selector) {\n  const map = L.map(selector, {\n    center: [18, 0],\n    zoom: 2,\n    minZoom: 2,\n    maxZoom: 10,\n    scrollWheelZoom: false\n  });\n\n  L.tileLayer('https://api.mapbox.com/v4/{id}/{z}/{x}/{y}' + (L.Browser.retina ? '@2x' : '') + '.png?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery Â© <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'oxy.ndp8318l',\n    accessToken: L.mapbox.accessToken\n  }).addTo(map);\n\n  return map;\n}\n\nfunction prepareLayers(type, data, groupOptions) {\n  const collection = _.chain(data)\n    // If it's TopoJson require that there be arcs.\n    .filter(featureGroup => {\n      return featureGroup.features.type !== 'Topology' || featureGroup.features.arcs.length;\n    })\n    .forEach(featureGroup => {\n      if (featureGroup.features.type === 'Topology') {\n        const layer = L.geoJson(null, groupOptions);\n        featureGroup.layer = topojson.parse(featureGroup.features, null, layer);\n      } else {\n        featureGroup.layer = L.geoJson(featureGroup.features, groupOptions);\n      }\n\n      featureGroup.layer.type = type;\n      featureGroup.layer.id = featureGroup.properties.id;\n    })\n    .keyBy(featureGroup => featureGroup.properties.name)\n    .value();\n\n  return _.mapValues(collection, 'layer');\n}\n\nfunction createControl(type, layers) {\n  const control = L.control.layers(null, layers, {collapsed: true}).addTo(lMap);\n  // Add custom classes to the leaflet control\n  const container = control.getContainer();\n  L.DomUtil.addClass(container, 'control-custom');\n  L.DomUtil.addClass(container, 'control-' + type);\n\n  if (L.Browser.touch) {\n    L.DomEvent.disableClickPropagation(container);\n  } else {\n    L.DomEvent\n      .disableClickPropagation(container)\n      .disableScrollPropagation(container);\n  }\n\n  return control;\n}\n\nfunction toggleControlCheckboxes(control, labels, onState) {\n  // List of the layer ids corresponding the the listed labels (strings).\n  const layerIds = _.chain(control._layers)\n    .pick(layer => labels.includes(layer.layer.id))\n    .keys()\n    .value();\n\n  // Iterate over all the checkboxes in the controls form,\n  const inputs = control._layerControlInputs;\n  for (let i = 0, l = inputs.length; i < l; i++) {\n    const input = inputs[i];\n    // Skip checkboxes for countries not part of this trip.\n    if (!layerIds.includes(String(input.layerId))) {\n      continue;\n    }\n\n    // The checkbox is already checked.\n    if (onState && input.checked) {\n      continue;\n    }\n\n    // The checkbox is already unchecked.\n    if (!onState && !input.checked) {\n      continue;\n    }\n\n    // Trigger a click so that Leaflet acts on it and triggers this\n    // same event but for each country.\n    input.click();\n  }\n}\n\nfunction setTripLayerStyles(feature, layer) {\n  const defaultStyle = getRouteStyle(feature);\n  bindRoutePopup(feature, layer);\n  layer.setStyle(defaultStyle);\n\n  (function () { // @todo\n    layer.on('mouseover', () => layer.setStyle(routeStyles.mouseover));\n    layer.on('mouseout', () => layer.setStyle(defaultStyle));\n  })();\n}\n\nfunction createSearchControl() {\n  const control = new L.Control.Search({\n    layer: cluster,\n    propertyName: 'name',\n    circleLocation: false,\n    initial: false,\n    autoCollapse: true,\n    zoom: 10\n  });\n\n  control.on('search_locationfound', e => openPopup(e.layer));\n  return control;\n}\n\nfunction createCountryLayers(countryCollection) {\n  countryCollection = countryCollection.sort((a, b) => {\n    if (a.properties.id < b.properties.id) {\n      return -1;\n    }\n\n    if (a.properties.id > b.properties.id) {\n      return 1;\n    }\n\n    return 0;\n  });\n  // The real layers\n  const countryLayers = prepareLayers('country', countryCollection, {onEachFeature: bindMarkerPopup, pointToLayer: getMarkerIcon});\n  // @see https://github.com/Leaflet/Leaflet.markercluster/issues/13\n  // Create dummy layers without markers. When these are clicked, the\n  // corresponding real layer will be added/removed to the\n  // MarkerClusterGroup.\n  const dummyLayers = {};\n  _.forEach(countryLayers, (layer, name) => {\n    dummyLayers[name] = L.layerGroup();\n    dummyLayers[name].type = 'country';\n    dummyLayers[name].id = layer.id;\n    // If a pre-selected country is defiend, exit here so that it's not\n    // preselected.\n    if (preSelectedCountries.length > 0 && !preSelectedCountries.includes(layer.id)) {\n      return;\n    }\n\n    // Dummy layer is attached to Map\n    dummyLayers[name].addTo(lMap);\n    // Real layer is attached to MarkerClusterGroup\n    cluster.addLayer(layer);\n  });\n\n  // Controls point the the dummy layers.\n  const countryControl = createControl('country', dummyLayers);\n  controls.country = countryControl;\n\n  // Add a mapping so that we can find the real layer alter.\n  for (const row in countryControl._layers) {\n    if (countryControl._layers[row]) {\n      leafletMeta[L.Util.stamp(countryControl._layers[row].layer)] = countryControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', overlay => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'country') {\n      return;\n    }\n\n    if (overlay.type === 'overlayadd') {\n      cluster.addLayer(countryLayers[index]);\n    } else {\n      cluster.removeLayer(countryLayers[index]);\n    }\n  });\n\n  return countryLayers;\n}\n\nfunction createTripLayers(tripCollection) {\n  const tripLayers = prepareLayers('trip', tripCollection, {onEachFeature: setTripLayerStyles});\n  if (preSelectedCountries.length === 0) {\n    _.forEach(tripLayers, layer => layer.addTo(lMap));\n  }\n\n  const tripControl = createControl('trip', tripLayers);\n  controls.trip = tripControl;\n\n  for (const row in tripControl._layers) {\n    if (tripControl._layers[row]) {\n      leafletMeta[L.Util.stamp(tripControl._layers[row].layer)] = tripControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', overlay => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'trip') {\n      return;\n    }\n\n    const trip = tripCollection[index];\n    const countries = _.map(trip.properties.countries, 'name');\n    const control = controls.country;\n    const on = (overlay.type === 'overlayadd');\n\n    toggleControlCheckboxes(control, countries, on);\n  });\n\n  if (preSelectedTrips.length > 0) {\n    console.log(tripLayers);\n    _.chain(tripLayers)\n      .forEach(layer => {\n        console.log(layer);\n      })\n      .filter(layer => !preSelectedTrips.includes(layer.id))\n      .forEach(layer => {\n        console.log(layer);\n        lMap.removeLayer(layer);\n      })\n      .value();\n\n    _.chain(tripLayers)\n      .filter(layer => preSelectedTrips.includes(layer.id))\n      .forEach(layer => {\n        console.log(layer);\n        lMap.removeLayer(layer);\n        lMap.addLayer(layer);\n      })\n      .value();\n  }\n}\n\nfunction init(data) {\n  // Issue XHR requests for the routes of all trips, but do it async while\n  // rendering regular markers.\n  let tripCollection = _.forEach(data.trips, trip => {\n    trip.promise = fetch(`/${trip.path}`);\n  });\n\n  // Remove the placeholder image as it gets displayed while tiles are\n  // fetched.\n  lMap.once('zoomstart', () => {\n    map.style.backgroundImage = 'none';\n  });\n\n  lMap.on('overlayadd overlayremove', _.debounce(event => {\n    if (event.layer.type && event.layer.type === 'country') {\n      const layers = cluster.getLayers();\n      if (layers.length === 0) {\n        return;\n      }\n\n      const bounds = new L.LatLngBounds();\n      for (let i = 0, l = layers.length; i < l; i++) {\n        bounds.extend(layers[i].getLatLng());\n      }\n\n      lMap.fitBounds(bounds);\n    }\n  }, 100));\n\n  // Create the country layers.\n  createCountryLayers(data.countries);\n  lMap.addControl(createSearchControl());\n\n  // Wait for all requests to finish\n  Promise.all(_.map(tripCollection, trip => {\n    return trip.promise\n      .then(data => data.json())\n      .catch(error => error);\n  })).then(responses => {\n    tripCollection = _.chain(tripCollection)\n      // Attach the features collected from the XHR request.\n      .forEach((trip, idx) => {\n        trip.features = responses[idx];\n      })\n      .keyBy(trip => trip.properties.name)\n      .value();\n\n    // Create the trip layers.\n    createTripLayers(tripCollection);\n\n    if (!controls.other) {\n      controls.other = L.control.layers(null, null, {collapsed: false}).addTo(lMap);\n      controls.other.addOverlay(cluster, 'Markers');\n    }\n  });\n}\n","// removed by extract-text-webpack-plugin","// removed by extract-text-webpack-plugin","/* (ignored) */"],"sourceRoot":""}