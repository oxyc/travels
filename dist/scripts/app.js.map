{"version":3,"sources":["webpack:///./_resources/scripts/app.js","webpack:///./_resources/scripts/charts.js","webpack:///./_resources/scripts/commits.js","webpack:///./_resources/scripts/map.js","webpack:///./_resources/styles/abovefold.scss?8786","webpack:///./_resources/styles/app.scss?1199","webpack:///xmldom (ignored)"],"names":["$charts","$","length","getJSON","init","tooltipVisible","tagsHidden","templateExpenseTable","_","template","tripDate","tagTotalData","chartTypes","perTagCPD","el","data","options","duration","calculateTotalDuration","countryData","country","series","chain","groupBy","map","tagData","tag","amount","sumBy","row","transaction","parseInt","Math","round","name","y","value","Highcharts","chart","type","plotOptions","pie","allowPointSelect","dataLabels","enabled","showInLegend","events","click","event","point","expenses","filter","expense","tags","showExpenseTable","target","tooltip","valuePrefix","valueSuffix","pointFormat","title","text","perCountryCPD","countryList","countryDuration","getDateSpan","fill","Array","tagTotalAmount","each","countryIndex","indexOf","total","visible","isVisibleByDefault","redraw","axis","axes","removePlotLine","addPlotLine","getAveragePlotLine","xAxis","categories","yAxis","min","labels","format","stackLabels","style","color","fontWeight","textShadow","plotLines","legend","reversed","stacking","bar","category","element","tooltipInitalizer","tippyHideAll","exclude","_tippy","tippy","content","trigger","show","tripDuration","end","start","totalAmount","reduce","width","zIndex","id","keyBy","mapValues","dates","date","Date","earliestDate","now","latestDate","flatten","idx","$this","chartType","trip","tripData","expenditures","push","countries","html","document","on","$el","path","done","commit","L","Icon","Default","imagePath","mapbox","accessToken","MakiMarkers","AJAX_TIMEOUT","lMap","createMap","cluster","markerClusterGroup","maxClusterRadius","addTo","controls","markers","trek","icon","city","park","homebase","photo","size","visited","routeStyles","opacity","weight","route","tour","flight","boat","mouseover","$map","preSelectedTrips","reject","split","isEmpty","preSelectedCountries","leafletMeta","templateMarkerPopup","templateRoutePopup","openPopup","layer","hasLayer","_icon","__parent","zoomToShowLayer","_popup","pairs","array","slice","b","i","bindMarkerPopup","feature","properties","bindPopup","bindRoutePopup","distance","geometry","coordinates","pair","latLng","distanceTo","getMarkerIcon","latlng","key","toLowerCase","hasOwnProperty","marker","clone","getRouteStyle","selector","center","zoom","minZoom","maxZoom","scrollWheelZoom","tileLayer","Browser","retina","attribution","prepareLayers","groupOptions","collection","featureGroup","features","arcs","forEach","geoJson","topojson","parse","createControl","layers","control","collapsed","container","getContainer","DomUtil","addClass","touch","DomEvent","disableClickPropagation","disableScrollPropagation","toggleControlCheckboxes","onState","layerIds","_layers","pick","keys","inputs","_form","getElementsByTagName","l","input","String","layerId","checked","setTripLayerStyles","defaultStyle","setStyle","createSearchControl","Control","Search","propertyName","circleLocation","initial","autoCollapse","e","createCountryLayers","countryCollection","sort","a","countryLayers","onEachFeature","pointToLayer","dummyLayers","layerGroup","addLayer","countryControl","Util","stamp","overlay","index","removeLayer","createTripLayers","tripCollection","tripLayers","tripControl","trips","promise","ajax","dataType","url","timeout","once","css","debounce","getLayers","bounds","LatLngBounds","extend","getLatLng","fitBounds","addControl","Promise","allSettled","then","statusCode","status","responseJSON","other","addOverlay"],"mappings":"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","file":"/scripts/app.js","sourcesContent":["import './map.js';\nimport './charts.js';\nimport './commits.js';","import $ from 'jquery';\nimport _ from 'lodash';\nimport tippy from 'tippy.js';\nimport { hideAll as tippyHideAll } from 'tippy.js';\nimport Highcharts from 'highcharts';\n\nconst $charts = $('.expenditure-chart');\nif ($charts.length) {\n  $.getJSON('/expenditures.json', init);\n}\n\nlet tooltipVisible = false;\n\nconst tagsHidden = ['flight', 'boat', 'tour'];\n\nconst templateExpenseTable = _.template(\n  '<table>' +\n  '<tr><th>Date</th><th>Amount</th><th>Description</th></tr>' +\n  '<% _.forEach(data, function (row) { %>' +\n  '<tr><td><%- row.date %><td>$<%- row.amount %></td><td><%- row.description || \"\" %></td></tr>' +\n  '<% }); %>' +\n  '</table>'\n);\n\nlet tripDate;\nconst tagTotalData = {};\n\nconst chartTypes = {\n  perTagCPD: (el, data, options) => {\n    let duration = calculateTotalDuration(options.countryData);\n    duration = duration[options.country];\n\n    const series = _.chain(data)\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        let amount = _.sumBy(row, (transaction) => parseInt(transaction.amount));\n        amount = Math.round(amount / duration * 100) / 100;\n        return {name: tag, y: amount};\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {type: 'pie'},\n      plotOptions: {\n        pie: {\n          allowPointSelect: true,\n          dataLabels: {enabled: false},\n          showInLegend: true,\n          events: {\n            click: (event) => {\n              const tag = event.point.name;\n              const expenses = _.filter(data, (expense) => expense.tags === tag);\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {\n        valuePrefix: '$',\n        valueSuffix: '/day',\n        pointFormat: '<b>{point.y} ({point.percentage:.1f}%)</b><br/>'\n      },\n      title: {text: options.title || ''},\n      series: [{name: 'Tags', data: series}]\n    });\n  },\n\n  perCountryCPD: (el, data, options) => {\n    // List of country names used as x-axis\n    const countryList = _.map(options.countryData, 'name');\n    // Calculate the duration in each country based on the dates.\n    // [{ name: 'country', dates: [{start: x, end: y}] }] => { country: 2 }\n    const countryDuration = calculateTotalDuration(options.countryData);\n    tripDate = getDateSpan(options.countryData);\n\n    // List of tags used as y-axis\n    const series = _.chain(data)\n      // Each tag has its own entry\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        // Create an array with an index for each country.\n        const countryData = _.fill(Array(countryList.length), 0);\n        let tagTotalAmount = 0;\n        _.chain(tagData)\n          .groupBy('country')\n          .each((row, country) => {\n            const countryIndex = _.indexOf(countryList, country);\n            const duration = countryDuration[country];\n            // Only add the data if we can calculate the cost per day.\n            if (duration) {\n              const total = _.sumBy(row, (transaction) => parseInt(transaction.amount));\n              tagTotalAmount += total;\n              countryData[countryIndex] = total / duration;\n              countryData[countryIndex] = Math.round(countryData[countryIndex] * 100) / 100;\n            }\n          })\n          .value();\n\n        tagTotalData[tag] = tagTotalAmount;\n\n        return {\n          name: tag,\n          visible: isVisibleByDefault(tag),\n          data: countryData\n        };\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {\n        type: 'bar',\n        events: {\n          redraw: () => {\n            var axis = this.axes[1];\n            axis.removePlotLine('plot-average');\n            axis.addPlotLine(getAveragePlotLine(axis.series));\n          }\n        }\n      },\n      xAxis: {categories: countryList},\n      yAxis: {\n        min: 0, title: {text: 'Cost per day'}, labels: {format: '${value}'},\n        stackLabels: {\n          enabled: true,\n          style: {color: '#999', fontWeight: 'normal', textShadow: 'none'}\n        },\n        plotLines: [getAveragePlotLine(series)]\n      },\n      legend: {reversed: true},\n      plotOptions: {\n        series: {stacking: 'normal'},\n        bar: {\n          events: {\n            click(event) {\n              const country = event.point.category;\n              const tag = this.name;\n              const expenses = _.filter(data, (expense) => {\n                return (expense.country === country && expense.tags === tag);\n              });\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {valuePrefix: '$'},\n      title: {text: options.title || ''},\n      series: series\n    });\n  }\n};\n\nfunction showExpenseTable(element, expenses) {\n  // Make this element distinquishable in the auto-close listener.\n  element.tooltipInitalizer = true;\n  tippyHideAll({exclude: element});\n  // @todo\n  const tooltip = element._tippy || tippy(element, {\n    content: templateExpenseTable({data: expenses}),\n    trigger: 'click',\n  });\n  tooltip.show();\n  tooltipVisible = true;\n}\n\nfunction isVisibleByDefault(tag) {\n  return tagsHidden.indexOf(tag) === -1;\n}\n\nfunction getAveragePlotLine(series) {\n  const tripDuration = (tripDate.end - tripDate.start) / 1000 / 3600 / 24 + 1;\n  const totalAmount = _.chain(series)\n    .filter('visible')\n    .reduce((total, series) => total + tagTotalData[series.name], 0)\n    .value();\n\n  return {\n    value: totalAmount / tripDuration,\n    color: 'red',\n    width: 2,\n    zIndex: 20,\n    id: 'plot-average'\n  };\n}\n\nfunction calculateTotalDuration(data) {\n  return _.chain(data)\n    .keyBy('name')\n    .mapValues(function (country) {\n      return _.reduce(country.dates, (total, date) => {\n        const start = new Date(date.start);\n        const end = new Date(date.end);\n        return total + (end - start) / 1000 / 3600 / 24 + 1;\n      }, 0);\n    })\n    .value();\n}\n\nfunction getDateSpan(data) {\n  let earliestDate = _.now();\n  let latestDate = 0;\n\n  _.chain(data)\n    .map('dates')\n    .flatten()\n    .each((date) => {\n      const start = new Date(date.start);\n      const end = new Date(date.end);\n      if (start < earliestDate) {\n        earliestDate = start;\n      }\n      if (end > latestDate) {\n        latestDate = end;\n      }\n    })\n    .value();\n\n  return {\n    start: earliestDate,\n    end: latestDate\n  };\n}\n\nfunction init(data) {\n  $charts.each((idx, el) => {\n    const $this = $(el);\n    const chartType = $this.data('chart');\n    const options = {\n      trip: $this.data('trip'),\n      country: $this.data('country'),\n      title: $this.data('title'),\n      countryData: []\n    };\n    const tripData = _.chain(data.expenditures)\n      .filter('trip', options.trip)\n      .each((expenditures) => options.countryData.push(expenditures.countries))\n      .map('data')\n      .flatten()\n      .value();\n\n    // country dates should be merged really, but cant do it realiably as\n    // some might have dates but not expenditure entries.\n    options.countryData = _.chain(options.countryData)\n      .flatten(options.countryData)\n      .filter((country) => country.dates.length > 0)\n      .value();\n\n    if (options.country) {\n      tripData = _.filter(tripData, 'country', options.country);\n      options.countryData = _.filter(options.countryData, 'name', options.country);\n    }\n\n    if (!options.countryData.length) {\n      $this.html('<p><em>No data available yet</em></p>');\n      return;\n    }\n\n    chartTypes[chartType](el, tripData, options);\n  });\n\n  $(document).on('click', (event) => {\n    if (!tooltipVisible || (event.target && event.target.tooltipInitalizer)) {\n      return;\n    }\n    tippyHideAll();\n    tooltipVisible = false;\n  });\n}\n","import $ from 'jquery';\n\nconst $el = $('#commit-history');\nif ($el.length) {\n  const path = 'https://api.github.com/repos/oxyc/travels/commits';\n  const template = _.template(\n    '<li><a href=\"<%- html_url %>\"><span class=\"date\"><%- new Date(commit.author.date).toDateString() %></span> <%- commit.message %></li>'\n  );\n\n  $.getJSON(path)\n    .done((data) => {\n      const content = _.reduce(data, function (content, commit) {\n        return content + template(commit);\n      }, '');\n      $el.html(content);\n    });\n}","import $ from 'jquery';\nimport _ from 'lodash';\nimport L from 'leaflet';\nimport { topojson } from '@mapbox/leaflet-omnivore';\nimport 'leaflet.markercluster';\nimport 'leaflet-makimarkers';\nimport 'leaflet-search';\n\nL.Icon.Default.imagePath = '/dist/images';\nL.mapbox = L.mapbox || {};\nL.mapbox.accessToken = 'pk.eyJ1Ijoib3h5IiwiYSI6InBMaXRxSDAifQ.w9NqRLivEBn6BoMRkKmg3A';\nL.MakiMarkers.accessToken = L.mapbox.accessToken;\n\n// Short timeout as some geojson files might not exist yet.\nconst AJAX_TIMEOUT = 5000;\n\nexport const lMap = createMap('world-map');\nexport const cluster = L.markerClusterGroup({maxClusterRadius: 20}).addTo(lMap);\nexport const controls = {};\n\nexport const markers = {\n  trek: {icon: 'campsite', color: '#159957'},\n  city: {icon: 'circle', color: '#659CD6'},\n  park: {icon: 'park', color: '#159957'},\n  homebase: {icon: 'building', color: '#D85E5E'},\n  photo: {icon: 'camera', color: '#659CD6', size: 's'},\n  visited: {color: '#659CD6'}\n};\n\nexport const routeStyles = {\n  trek: {color: '#159957', opacity: 1, weight: 5},\n  route: {color: '#000', opacity: 1, weight: 2},\n  tour: {color: '#000', opacity: 1, weight: 2},\n  flight: {color: '#000', opacity: 0.3, weight: 2},\n  boat: {color: '#2057D0', opacity: 0.3, weight: 2},\n  mouseover: {color: '#ff0000', opacity: 0.7, weight: 3}\n};\n\nconst $map = $('#world-map');\n\nconst preSelectedTrips = _.reject($map.data('trips').split(' ') || [], _.isEmpty);\nconst preSelectedCountries = _.reject($map.data('country').split(' ') || [], _.isEmpty);\nconst leafletMeta = {};\n\n// Initialize\n$.getJSON('/world.json').done(init);\n\nconst templateMarkerPopup = _.template(\n  '<strong><%- name %>, <%- _.startCase(country) %></strong> <small><%- type %></small><br>' +\n  '<% if (!visited) { %><em>planning to visit</em><br><% } %>' +\n  '<% if (typeof homebase !== \"undefined\" && homebase) { %><em>I used to live here</em><% } %>' +\n  '<% if (typeof description !== \"undefined\") { %><span class=\"description\"><%- description %></span><% } %>'\n);\nconst templateRoutePopup = _.template(\n  '<strong><%- name %></strong> <small><%- type %></small><br>' +\n  'Distance: <%- Math.round(distance / 1000) %> km'\n);\n\nexport function openPopup(layer) {\n  // Exit if the layer isnt visible\n  if (!cluster.hasLayer(layer) || (!layer._icon && !layer.__parent._icon)) {\n    return false;\n  }\n  cluster.zoomToShowLayer(layer, () => {\n    if (layer._popup) {\n      layer.openPopup();\n    }\n  });\n};\n\nfunction pairs(array) {\n  return array.slice(1).map((b, i) => [array[i], b]);\n}\n\nfunction bindMarkerPopup(feature, layer) {\n  const content = templateMarkerPopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction bindRoutePopup(feature, layer) {\n  feature.properties.distance = _.reduce(pairs(feature.geometry.coordinates), (total, pair) => {\n    return total + L.latLng(pair[0][1], pair[0][0])\n      .distanceTo(L.latLng(pair[1][1], pair[1][0]));\n  }, 0);\n  const content = templateRoutePopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction getMarkerIcon(feature, latlng) {\n  let key = feature.properties.type.toLowerCase();\n  if (feature.properties.homebase) {\n    key = 'homebase';\n  } else if (['national park', 'nature reserve'].indexOf(key) !== -1) {\n    key = 'park';\n  } else if (!markers.hasOwnProperty(key)) {\n    key = 'visited';\n  }\n\n  let marker = markers[key];\n  if (!feature.properties.visited) {\n    marker = _.clone(marker);\n    marker.color = '#999';\n  }\n\n  return L.marker(latlng, {icon: L.MakiMarkers.icon(marker)});\n}\n\nfunction getRouteStyle(feature) {\n  return routeStyles[feature.properties.type.toLowerCase()];\n}\n\nfunction createMap(selector) {\n  const map = L.map(selector, {\n    center: [18, 0],\n    zoom: 2,\n    minZoom: 2,\n    maxZoom: 10,\n    scrollWheelZoom: false\n  });\n\n  L.tileLayer('https://api.mapbox.com/v4/{id}/{z}/{x}/{y}' + (L.Browser.retina ? '@2x' : '') + '.png?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery Â© <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'oxy.ndp8318l',\n    accessToken: L.mapbox.accessToken,\n  }).addTo(map);\n\n  return map;\n}\n\nfunction prepareLayers(type, data, groupOptions) {\n  const collection = _.chain(data)\n    // If it's TopoJson require that there be arcs.\n    .filter((featureGroup) => {\n      return featureGroup.features.type !== 'Topology' || featureGroup.features.arcs.length;\n    })\n    .forEach((featureGroup) => {\n      if (featureGroup.features.type === 'Topology') {\n        var layer = L.geoJson(null, groupOptions);\n        featureGroup.layer = topojson.parse(featureGroup.features, null, layer);\n      } else {\n        featureGroup.layer = L.geoJson(featureGroup.features, groupOptions);\n      }\n      featureGroup.layer.type = type;\n      featureGroup.layer.id = featureGroup.properties.id;\n    })\n    .keyBy((featureGroup) => featureGroup.properties.name)\n    .value();\n\n  return _.mapValues(collection, 'layer');\n}\n\nfunction createControl(type, layers) {\n  const control = L.control.layers(null, layers, {collapsed: true}).addTo(lMap);\n  // Add custom classes to the leaflet control\n  const container = control.getContainer();\n  L.DomUtil.addClass(container, 'control-custom');\n  L.DomUtil.addClass(container, 'control-' + type);\n\n  if (!L.Browser.touch) {\n    L.DomEvent\n      .disableClickPropagation(container)\n      .disableScrollPropagation(container);\n  } else {\n    L.DomEvent.disableClickPropagation(container);\n  }\n  return control;\n}\n\nfunction toggleControlCheckboxes(control, labels, onState) {\n  // List of the layer ids corresponding the the listed labels (strings).\n  const layerIds = _.chain(control._layers)\n    .pick((layer) => labels.indexOf(layer.layer.id) !== -1)\n    .keys()\n    .value();\n\n  // Iterate over all the checkboxes in the controls form,\n  const inputs = control._form.getElementsByTagName('input');\n  for (let i = 0, l = inputs.length; i < l; i++) {\n    let input = inputs[i];\n    // Skip checkboxes for countries not part of this trip.\n    if (layerIds.indexOf(String(input.layerId)) === -1) {\n      continue;\n    }\n    // The checkbox is already checked.\n    if (onState && input.checked) {\n      continue;\n    }\n    // The checkbox is already unchecked.\n    if (!onState && !input.checked) {\n      continue;\n    }\n    // Trigger a click so that Leaflet acts on it and triggers this\n    // same event but for each country.\n    $(input).trigger('click');\n  }\n}\n\nfunction setTripLayerStyles(feature, layer) {\n  const defaultStyle = getRouteStyle(feature);\n  bindRoutePopup(feature, layer);\n  layer.setStyle(defaultStyle);\n\n  (function () { // @todo\n    layer.on('mouseover', () => layer.setStyle(routeStyles.mouseover));\n    layer.on('mouseout', () => layer.setStyle(defaultStyle));\n  })();\n}\n\nfunction createSearchControl() {\n  const control = new L.Control.Search({\n    layer: cluster,\n    propertyName: 'name',\n    circleLocation: false,\n    initial: false,\n    autoCollapse: true,\n    zoom: 10\n  });\n\n  control.on('search_locationfound', (e) => openPopup(e.layer));\n  return control;\n}\n\nfunction createCountryLayers(countryCollection) {\n  countryCollection = countryCollection.sort((a, b) => {\n    if (a.properties.id < b.properties.id) {\n      return -1;\n    }\n    if (a.properties.id > b.properties.id) {\n      return 1;\n    }\n    return 0;\n  });\n  // The real layers\n  const countryLayers = prepareLayers('country', countryCollection, {onEachFeature: bindMarkerPopup, pointToLayer: getMarkerIcon});\n  // @see https://github.com/Leaflet/Leaflet.markercluster/issues/13\n  // Create dummy layers without markers. When these are clicked, the\n  // corresponding real layer will be added/removed to the\n  // MarkerClusterGroup.\n  const dummyLayers = {};\n  _.forEach(countryLayers, (layer, name) => {\n    dummyLayers[name] = L.layerGroup();\n    dummyLayers[name].type = 'country';\n    dummyLayers[name].id = layer.id;\n    // If a pre-selected country is defiend, exit here so that it's not\n    // preselected.\n    if (preSelectedCountries.length && preSelectedCountries.indexOf(layer.id) === -1) {\n      return;\n    }\n    // Dummy layer is attached to Map\n    dummyLayers[name].addTo(lMap);\n    // Real layer is attached to MarkerClusterGroup\n    cluster.addLayer(layer);\n  });\n\n  // Controls point the the dummy layers.\n  const countryControl = controls.country = createControl('country', dummyLayers);\n  // Add a mapping so that we can find the real layer alter.\n  for (let row in countryControl._layers) {\n    if (countryControl._layers.hasOwnProperty(row)) {\n      leafletMeta[L.Util.stamp(countryControl._layers[row].layer)] = countryControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', (overlay) => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'country') {\n      return;\n    }\n\n    if (overlay.type === 'overlayadd') {\n      cluster.addLayer(countryLayers[index]);\n    } else {\n      cluster.removeLayer(countryLayers[index]);\n    }\n  });\n\n  return countryLayers;\n}\n\nfunction createTripLayers(tripCollection) {\n  const tripLayers = prepareLayers('trip', tripCollection, {onEachFeature: setTripLayerStyles});\n  if (!preSelectedCountries.length) {\n    _.forEach(tripLayers, (layer) => layer.addTo(lMap));\n  }\n  const tripControl = controls.trip = createControl('trip', tripLayers);\n\n  for (let row in tripControl._layers) {\n    if (tripControl._layers.hasOwnProperty(row)) {\n      leafletMeta[L.Util.stamp(tripControl._layers[row].layer)] = tripControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', (overlay) => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'trip') {\n      return;\n    }\n    const trip = tripCollection[index];\n    const countries = _.map(trip.properties.countries, 'name');\n    const control = controls.country;\n    const on = (overlay.type === 'overlayadd');\n\n    toggleControlCheckboxes(control, countries, on);\n  });\n\n  if (preSelectedTrips.length) {\n    _.chain(tripLayers)\n      .pick((layer) => preSelectedTrips.indexOf(layer.id) === -1)\n      .forEach((layer) => lMap.removeLayer(layer))\n      .value();\n\n    _.chain(tripLayers)\n      .pick((layer) => preSelectedTrips.indexOf(layer.id) !== -1)\n      .forEach((layer) => {\n        lMap.removeLayer(layer);\n        lMap.addLayer(layer);\n      })\n      .value();\n  }\n}\n\nfunction init(data) {\n  // Issue XHR requests for the routes of all trips, but do it async while\n  // rendering regular markers.\n  let tripCollection = _.forEach(data.trips, (trip) => {\n    trip.promise = $.ajax({\n      dataType: 'json',\n      url: '/' + trip.path,\n      timeout: AJAX_TIMEOUT\n    });\n  });\n\n  // Remove the placeholder image as it gets displayed while tiles are\n  // fetched.\n  lMap.once('zoomstart', () => $map.css('background-image', 'none'));\n\n  lMap.on('overlayadd overlayremove', _.debounce((event) => {\n    if (event.layer.type && event.layer.type === 'country') {\n      const layers = cluster.getLayers();\n      if (!layers.length) {\n        return;\n      }\n      const bounds = new L.LatLngBounds();\n      for (let i = 0, l = layers.length; i < l; i++) {\n        bounds.extend(layers[i].getLatLng());\n      }\n      lMap.fitBounds(bounds);\n    }\n  }, 100));\n\n  // Create the country layers.\n  createCountryLayers(data.countries);\n  lMap.addControl(createSearchControl());\n\n  // Wait for all requests to finish\n  Promise.allSettled(_.map(tripCollection, 'promise'))\n    .then(() => {\n      tripCollection = _.chain(tripCollection)\n        // Filter out failed requests.\n        .pick((trip) => trip.promise.statusCode().status === 200)\n        // Attach the features collected from the XHR request.\n        .forEach((trip) => trip.features = trip.promise.responseJSON)\n        .keyBy((trip) => trip.properties.name)\n        .value();\n\n      // Create the trip layers.\n      createTripLayers(tripCollection);\n\n      if (!controls.other) {\n        controls.other = L.control.layers(null, null, {collapsed: false}).addTo(lMap);\n        controls.other.addOverlay(cluster, 'Markers');\n      }\n    });\n}","// removed by extract-text-webpack-plugin","// removed by extract-text-webpack-plugin","/* (ignored) */"],"sourceRoot":""}