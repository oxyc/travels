{"version":3,"sources":["webpack:///./_resources/scripts/app.js","webpack:///./_resources/scripts/charts.js","webpack:///./_resources/scripts/commits.js","webpack:///./_resources/scripts/map.js","webpack:///./_resources/styles/abovefold.scss?8786","webpack:///./_resources/styles/app.scss?1199"],"names":["setGlobalVhValue","vh","window","innerHeight","document","documentElement","style","setProperty","addEventListener","charts","querySelectorAll","fetch","then","data","json","init","tooltipVisible","tagsHidden","templateExpenseTable","_","template","tripDate","tagTotalData","chartTypes","perTagCPD","el","options","duration","calculateTotalDuration","countryData","country","series","chain","filter","entry","groupBy","map","tagData","tag","amount","sumBy","transaction","parseInt","Math","round","name","y","value","Highcharts","chart","type","plotOptions","pie","allowPointSelect","dataLabels","enabled","showInLegend","events","click","event","point","expenses","expense","tags","showExpenseTable","target","tooltip","valuePrefix","valueSuffix","pointFormat","title","text","perCountryCPD","countryList","countryDuration","getDateSpan","fill","Array","length","tagTotalAmount","each","row","countryIndex","indexOf","total","visible","isVisibleByDefault","redraw","axis","axes","removePlotLine","addPlotLine","getAveragePlotLine","xAxis","categories","yAxis","min","labels","format","stackLabels","color","fontWeight","textShadow","plotLines","legend","reversed","stacking","bar","category","element","tooltipInitalizer","tippyHideAll","exclude","_tippy","tippy","content","trigger","show","includes","tripDuration","end","start","totalAmount","reduce","width","zIndex","id","keyBy","mapValues","dates","date","Date","earliestDate","now","latestDate","flatten","chartType","dataset","trip","tripData","expenditures","push","countries","innerHTML","querySelector","path","commit","L","Icon","Default","imagePath","mapbox","accessToken","MakiMarkers","Control","LayersCloseAll","Layers","extend","onAdd","_initLayout","_addButton","_update","_map","on","_checkDisabledLayers","i","_layers","layer","_onLayerChange","_container","elements","button","DomUtil","create","textContent","DomEvent","e","stop","toggled","toggleControlCheckboxes","lMap","createMap","cluster","markerClusterGroup","maxClusterRadius","addTo","controls","markers","trek","icon","city","park","homebase","photo","size","visited","routeStyles","opacity","weight","route","tour","flight","boat","mouseover","preSelectedTrips","reject","trips","split","isEmpty","preSelectedCountries","leafletMeta","templateMarkerPopup","templateRoutePopup","openPopup","hasLayer","_icon","__parent","zoomToShowLayer","_popup","pairs","array","slice","b","bindMarkerPopup","feature","properties","bindPopup","bindRoutePopup","distance","geometry","coordinates","pair","latLng","distanceTo","getMarkerIcon","latlng","key","toLowerCase","marker","clone","getRouteStyle","selector","center","zoom","minZoom","maxZoom","scrollWheelZoom","tileLayer","attribution","prepareLayers","groupOptions","collection","featureGroup","features","arcs","forEach","topojsonFeature","geoJson","createControl","layers","control","collapsed","container","getContainer","addClass","disableClickPropagation","onState","layerIds","pick","_leaflet_id","inputs","_layerControlInputs","l","input","layerId","checked","setTripLayerStyles","defaultStyle","setStyle","createSearchControl","Search","propertyName","circleLocation","initial","autoCollapse","createCountryLayers","countryCollection","sort","a","countryLayers","onEachFeature","pointToLayer","dummyLayers","layerGroup","addLayer","countryControl","Util","stamp","overlay","index","removeLayer","createTripLayers","tripCollection","tripLayers","tripControl","promise","once","backgroundImage","debounce","getLayers","bounds","LatLngBounds","getLatLng","fitBounds","addControl","Promise","all","error","responses","idx","other","addOverlay"],"mappings":"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","file":"/scripts/app.js","sourcesContent":["const setGlobalVhValue = () => {\n  const vh = window.innerHeight * 0.01;\n  document.documentElement.style.setProperty('--vh', `${vh}px`);\n};\n\nsetGlobalVhValue();\nwindow.addEventListener('resize', setGlobalVhValue);\n\nimport './map';\nimport './charts';\nimport './commits';\n","import _ from 'lodash';\nimport tippy, {hideAll as tippyHideAll} from 'tippy.js';\nimport Highcharts from 'highcharts';\n\nconst charts = document.querySelectorAll('.expenditure-chart');\nif (charts) {\n  fetch('/expenditures.json')\n    .then(data => data.json())\n    .then(init);\n}\n\nlet tooltipVisible = false;\n\nconst tagsHidden = ['flight', 'boat', 'tour'];\n\nconst templateExpenseTable = _.template(\n  '<table>' +\n  '<tr><th>Date</th><th>Amount</th><th>Description</th></tr>' +\n  '<% _.forEach(data, function (row) { %>' +\n  '<tr><td><%- row.date %><td>$<%- row.amount %></td><td><%- row.description || \"\" %></td></tr>' +\n  '<% }); %>' +\n  '</table>'\n);\n\nlet tripDate;\nconst tagTotalData = {};\n\nconst chartTypes = {\n  perTagCPD: (el, data, options) => {\n    let duration = calculateTotalDuration(options.countryData);\n    duration = duration[options.country];\n\n    const series = _.chain(data)\n      .filter(entry => entry.country === options.country)\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        let amount = _.sumBy(tagData, transaction => parseInt(transaction.amount, 10));\n        amount = Math.round(amount / duration * 100) / 100;\n        return {name: tag, y: amount};\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {type: 'pie'},\n      plotOptions: {\n        pie: {\n          allowPointSelect: true,\n          dataLabels: {enabled: false},\n          showInLegend: true,\n          events: {\n            click: event => {\n              const tag = event.point.name;\n              const expenses = _.filter(data, expense => expense.tags === tag);\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {\n        valuePrefix: '$',\n        valueSuffix: '/day',\n        pointFormat: '<b>{point.y} ({point.percentage:.1f}%)</b><br/>'\n      },\n      title: {text: options.title || ''},\n      series: [{name: 'Tags', data: series}]\n    });\n  },\n\n  perCountryCPD: (el, data, options) => {\n    // List of country names used as x-axis\n    const countryList = _.map(options.countryData, 'name');\n    // Calculate the duration in each country based on the dates.\n    // [{ name: 'country', dates: [{start: x, end: y}] }] => { country: 2 }\n    const countryDuration = calculateTotalDuration(options.countryData);\n    tripDate = getDateSpan(options.countryData);\n\n    // List of tags used as y-axis\n    const series = _.chain(data)\n      // Each tag has its own entry\n      .groupBy('tags')\n      .map((tagData, tag) => {\n        // Create an array with an index for each country.\n        const countryData = _.fill(new Array(countryList.length), 0);\n        let tagTotalAmount = 0;\n        _.chain(tagData)\n          .groupBy('country')\n          .each((row, country) => {\n            const countryIndex = _.indexOf(countryList, country);\n            const duration = countryDuration[country];\n            // Only add the data if we can calculate the cost per day.\n            if (duration) {\n              const total = _.sumBy(row, transaction => parseInt(transaction.amount, 10));\n              tagTotalAmount += total;\n              countryData[countryIndex] = total / duration;\n              countryData[countryIndex] = Math.round(countryData[countryIndex] * 100) / 100;\n            }\n          })\n          .value();\n\n        tagTotalData[tag] = tagTotalAmount;\n\n        return {\n          name: tag,\n          visible: isVisibleByDefault(tag),\n          data: countryData\n        };\n      })\n      .value();\n\n    Highcharts.chart(el, {\n      chart: {\n        type: 'bar',\n        events: {\n          redraw() {\n            const axis = this.axes[1];\n            axis.removePlotLine('plot-average');\n            axis.addPlotLine(getAveragePlotLine(axis.series));\n          }\n        }\n      },\n      xAxis: {categories: countryList},\n      yAxis: {\n        min: 0,\n        title: {text: 'Cost per day'},\n        labels: {format: '${value}'}, /* eslint no-template-curly-in-string:off */\n        stackLabels: {\n          enabled: true,\n          style: {color: '#999', fontWeight: 'normal', textShadow: 'none'}\n        },\n        plotLines: [getAveragePlotLine(series)]\n      },\n      legend: {reversed: true},\n      plotOptions: {\n        series: {stacking: 'normal'},\n        bar: {\n          events: {\n            click(event) {\n              const country = event.point.category;\n              const tag = this.name;\n              const expenses = _.filter(data, expense => {\n                return (expense.country === country && expense.tags === tag);\n              });\n              showExpenseTable(event.target, expenses);\n            }\n          }\n        }\n      },\n      tooltip: {valuePrefix: '$'},\n      title: {text: options.title || ''},\n      series\n    });\n  }\n};\n\nfunction showExpenseTable(element, expenses) {\n  // Make this element distinquishable in the auto-close listener.\n  element.tooltipInitalizer = true;\n  tippyHideAll({exclude: element});\n  // @todo\n  const tooltip = element._tippy || tippy(element, {\n    content: templateExpenseTable({data: expenses}),\n    trigger: 'click'\n  });\n  tooltip.show();\n  tooltipVisible = true;\n}\n\nfunction isVisibleByDefault(tag) {\n  return !tagsHidden.includes(tag);\n}\n\nfunction getAveragePlotLine(series) {\n  const tripDuration = ((tripDate.end - tripDate.start) / 1000 / 3600 / 24) + 1;\n  const totalAmount = _.chain(series)\n    .filter('visible')\n    .reduce((total, series) => total + tagTotalData[series.name], 0)\n    .value();\n\n  return {\n    value: totalAmount / tripDuration,\n    color: 'red',\n    width: 2,\n    zIndex: 20,\n    id: 'plot-average'\n  };\n}\n\nfunction calculateTotalDuration(data) {\n  return _.chain(data)\n    .keyBy('name')\n    .mapValues(country => {\n      return _.reduce(country.dates, (total, date) => {\n        const start = new Date(date.start);\n        const end = new Date(date.end);\n        return total + ((end - start) / 1000 / 3600 / 24) + 1;\n      }, 0);\n    })\n    .value();\n}\n\nfunction getDateSpan(data) {\n  let earliestDate = _.now();\n  let latestDate = 0;\n\n  _.chain(data)\n    .map('dates')\n    .flatten()\n    .each(date => {\n      const start = new Date(date.start);\n      const end = new Date(date.end);\n      if (start < earliestDate) {\n        earliestDate = start;\n      }\n\n      if (end > latestDate) {\n        latestDate = end;\n      }\n    })\n    .value();\n\n  return {\n    start: earliestDate,\n    end: latestDate\n  };\n}\n\nfunction init(data) {\n  for (const el of charts) {\n    const chartType = el.dataset.chart;\n    const options = {\n      trip: el.dataset.trip,\n      country: el.dataset.country,\n      title: el.dataset.title,\n      countryData: []\n    };\n\n    let tripData = _.chain(data.expenditures)\n      .filter('trip', options.trip)\n      .each(expenditures => options.countryData.push(expenditures.countries))\n      .map('data')\n      .flatten()\n      .value();\n\n    // Country dates should be merged really, but cant do it reliably as\n    // some might have dates but not expenditure entries.\n    options.countryData = _.chain(options.countryData)\n      .flatten(options.countryData)\n      .filter(country => country.dates.length > 0)\n      .value();\n\n    if (options.country) {\n      tripData = _.filter(tripData, 'country', options.country);\n      options.countryData = _.filter(options.countryData, 'name', options.country);\n    }\n\n    if (options.countryData.length === 0) {\n      el.innerHTML = '<p><em>No data available yet</em></p>';\n\n      return;\n    }\n\n    chartTypes[chartType](el, tripData, options);\n  }\n\n  document.addEventListener('click', event => {\n    if (!tooltipVisible || (event.target && event.target.tooltipInitalizer)) {\n      return;\n    }\n\n    tippyHideAll();\n    tooltipVisible = false;\n  });\n}\n","import _ from 'lodash';\n\nconst el = document.querySelector('#commit-history');\nif (el) {\n  const path = 'https://api.github.com/repos/oxyc/travels/commits';\n  const template = _.template(\n    '<li><a href=\"<%- html_url %>\"><span class=\"date\"><%- new Date(commit.author.date).toDateString() %></span> <%- commit.message %></li>'\n  );\n\n  fetch(path)\n    .then(data => data.json())\n    .then(data => {\n      const content = _.reduce(data, (content, commit) => {\n        return content + template(commit);\n      }, '');\n      el.innerHTML = content;\n    });\n}\n","import _ from 'lodash';\nimport L from 'leaflet';\nimport {feature as topojsonFeature} from 'topojson-client';\nimport 'leaflet.markercluster';\nimport 'leaflet-makimarkers';\nimport 'leaflet-search';\n\nL.Icon.Default.imagePath = '/dist/images';\nL.mapbox = L.mapbox || {};\nL.mapbox.accessToken = 'pk.eyJ1Ijoib3h5IiwiYSI6InBMaXRxSDAifQ.w9NqRLivEBn6BoMRkKmg3A';\nL.MakiMarkers.accessToken = L.mapbox.accessToken;\n\nL.Control.LayersCloseAll = L.Control.Layers.extend({\n  onAdd(map) {\n    this._initLayout();\n    this._addButton();\n    this._update();\n\n    this._map = map;\n    map.on('zoomend', this._checkDisabledLayers, this);\n\n    for (let i = 0; i < this._layers.length; i++) {\n      this._layers[i].layer.on('add remove', this._onLayerChange, this);\n    }\n\n    return this._container;\n  },\n\n  _addButton() {\n    const elements = this._container.querySelectorAll('.leaflet-control-layers-list');\n    const button = L.DomUtil.create('button', 'button--toggle-layers', elements[0]);\n\n    button.textContent = 'Hide all';\n    L.DomEvent.on(button, 'click', function (e) {\n      L.DomEvent.stop(e);\n      if (button.toggled) {\n        toggleControlCheckboxes(this, null, true);\n        button.textContent = 'Hide all';\n        button.toggled = false;\n      } else {\n        toggleControlCheckboxes(this, null, false);\n        button.textContent = 'Show all';\n        button.toggled = true;\n      }\n    }, this);\n  }\n});\n\nexport const lMap = createMap('world-map');\nexport const cluster = L.markerClusterGroup({maxClusterRadius: 20}).addTo(lMap);\nexport const controls = {};\n\nexport const markers = {\n  trek: {icon: 'campsite', color: '#159957'},\n  city: {icon: 'circle', color: '#659CD6'},\n  park: {icon: 'park', color: '#159957'},\n  homebase: {icon: 'building', color: '#D85E5E'},\n  photo: {icon: 'camera', color: '#659CD6', size: 's'},\n  visited: {color: '#659CD6'}\n};\n\nexport const routeStyles = {\n  trek: {color: '#159957', opacity: 1, weight: 5},\n  route: {color: '#000', opacity: 1, weight: 2},\n  tour: {color: '#000', opacity: 1, weight: 2},\n  flight: {color: '#000', opacity: 0.3, weight: 2},\n  boat: {color: '#2057D0', opacity: 0.3, weight: 2},\n  mouseover: {color: '#ff0000', opacity: 0.7, weight: 3}\n};\n\nconst map = document.querySelector('#world-map');\n\nconst preSelectedTrips = _.reject(map.dataset.trips.split(' ') || [], _.isEmpty);\nconst preSelectedCountries = _.reject(map.dataset.country.split(' ') || [], _.isEmpty);\nconst leafletMeta = {};\n\n// Initialize\nfetch('/world.json')\n  .then(data => data.json())\n  .then(init);\n\nconst templateMarkerPopup = _.template(\n  '<strong><%- name %>, <%- _.startCase(country) %></strong> <small><%- type %></small><br>' +\n  '<% if (!visited) { %><em>planning to visit</em><br><% } %>' +\n  '<% if (typeof homebase !== \"undefined\" && homebase) { %><em>I used to live here</em><% } %>' +\n  '<% if (typeof description !== \"undefined\") { %><span class=\"description\"><%- description %></span><% } %>'\n);\nconst templateRoutePopup = _.template(\n  '<strong><%- name %></strong> <small><%- type %></small><br>' +\n  'Distance: <%- Math.round(distance / 1000) %> km'\n);\n\nexport function openPopup(layer) {\n  // Exit if the layer isnt visible\n  if (!cluster.hasLayer(layer) || (!layer._icon && !layer.__parent._icon)) {\n    return false;\n  }\n\n  cluster.zoomToShowLayer(layer, () => {\n    if (layer._popup) {\n      layer.openPopup();\n    }\n  });\n}\n\nfunction pairs(array) {\n  return array.slice(1).map((b, i) => [array[i], b]);\n}\n\nfunction bindMarkerPopup(feature, layer) {\n  const content = templateMarkerPopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction bindRoutePopup(feature, layer) {\n  feature.properties.distance = _.reduce(pairs(feature.geometry.coordinates), (total, pair) => {\n    return total + L.latLng(pair[0][1], pair[0][0])\n      .distanceTo(L.latLng(pair[1][1], pair[1][0]));\n  }, 0);\n\n  const content = templateRoutePopup(feature.properties);\n  layer.bindPopup(content);\n}\n\nfunction getMarkerIcon(feature, latlng) {\n  let key = feature.properties.type.toLowerCase();\n  if (feature.properties.homebase) {\n    key = 'homebase';\n  } else if (['national park', 'nature reserve'].includes(key)) {\n    key = 'park';\n  } else if (!markers[key]) {\n    key = 'visited';\n  }\n\n  let marker = markers[key];\n  if (!feature.properties.visited) {\n    marker = _.clone(marker);\n    marker.color = '#999';\n  }\n\n  return L.marker(latlng, {icon: L.MakiMarkers.icon(marker)});\n}\n\nfunction getRouteStyle(feature) {\n  return routeStyles[feature.properties.type.toLowerCase()];\n}\n\nfunction createMap(selector) {\n  const map = L.map(selector, {\n    center: [18, 0],\n    zoom: 2,\n    minZoom: 2,\n    maxZoom: 10,\n    scrollWheelZoom: true\n  });\n\n  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'mapbox/outdoors-v11',\n    accessToken: L.mapbox.accessToken\n  }).addTo(map);\n\n  return map;\n}\n\nfunction prepareLayers(type, data, groupOptions) {\n  const collection = _.chain(data)\n    // If it's TopoJson require that there be arcs.\n    .filter(featureGroup => {\n      return featureGroup.features.type !== 'Topology' || featureGroup.features.arcs.length;\n    })\n    .forEach(featureGroup => {\n      if (featureGroup.features.type === 'Topology') {\n        const features = topojsonFeature(featureGroup.features, featureGroup.properties.id);\n        featureGroup.layer = L.geoJson(features, groupOptions);\n      } else {\n        featureGroup.layer = L.geoJson(featureGroup.features, groupOptions);\n      }\n\n      featureGroup.layer.type = type;\n      featureGroup.layer.id = featureGroup.properties.id;\n    })\n    .keyBy(featureGroup => featureGroup.properties.name)\n    .value();\n\n  return _.mapValues(collection, 'layer');\n}\n\nfunction createControl(type, layers) {\n  const control = new L.Control.LayersCloseAll(null, layers, {collapsed: true}).addTo(lMap);\n\n  // Add custom classes to the leaflet control\n  const container = control.getContainer();\n  L.DomUtil.addClass(container, 'control-custom');\n  L.DomUtil.addClass(container, 'control-' + type);\n\n  L.DomEvent.disableClickPropagation(container);\n\n  return control;\n}\n\nfunction toggleControlCheckboxes(control, labels, onState) {\n  // List of the layer ids corresponding the the listed labels (strings).\n  let layerIds;\n  if (labels && labels.length > 0) {\n    layerIds = _.chain(control._layers)\n      .pick(layer => labels.includes(layer.layer.id))\n      .map(layer => layer.layer._leaflet_id)\n      .value();\n  } else {\n    layerIds = _.chain(control._layers)\n      .map(layer => layer.layer._leaflet_id)\n      .value();\n  }\n\n  // Iterate over all the checkboxes in the controls form,\n  const inputs = control._layerControlInputs;\n  for (let i = 0, l = inputs.length; i < l; i++) {\n    const input = inputs[i];\n    // Skip checkboxes for countries not part of this trip.\n    if (!layerIds.includes(input.layerId)) {\n      continue;\n    }\n\n    // The checkbox is already checked.\n    if (onState && input.checked) {\n      continue;\n    }\n\n    // The checkbox is already unchecked.\n    if (!onState && !input.checked) {\n      continue;\n    }\n\n    // Trigger a click so that Leaflet acts on it and triggers this\n    // same event but for each country.\n    input.click();\n  }\n}\n\nfunction setTripLayerStyles(feature, layer) {\n  const defaultStyle = getRouteStyle(feature);\n  bindRoutePopup(feature, layer);\n  layer.setStyle(defaultStyle);\n\n  (function () { // @todo\n    layer.on('mouseover', () => layer.setStyle(routeStyles.mouseover));\n    layer.on('mouseout', () => layer.setStyle(defaultStyle));\n  })();\n}\n\nfunction createSearchControl() {\n  const control = new L.Control.Search({\n    layer: cluster,\n    propertyName: 'name',\n    circleLocation: false,\n    initial: false,\n    autoCollapse: true,\n    zoom: 10\n  });\n\n  control.on('search_locationfound', e => openPopup(e.layer));\n  return control;\n}\n\nfunction createCountryLayers(countryCollection) {\n  countryCollection = countryCollection.sort((a, b) => {\n    if (a.properties.id < b.properties.id) {\n      return -1;\n    }\n\n    if (a.properties.id > b.properties.id) {\n      return 1;\n    }\n\n    return 0;\n  });\n  // The real layers\n  const countryLayers = prepareLayers('country', countryCollection, {onEachFeature: bindMarkerPopup, pointToLayer: getMarkerIcon});\n  // @see https://github.com/Leaflet/Leaflet.markercluster/issues/13\n  // Create dummy layers without markers. When these are clicked, the\n  // corresponding real layer will be added/removed to the\n  // MarkerClusterGroup.\n  const dummyLayers = {};\n  _.forEach(countryLayers, (layer, name) => {\n    dummyLayers[name] = L.layerGroup();\n    dummyLayers[name].type = 'country';\n    dummyLayers[name].id = layer.id;\n    // If a pre-selected country is defiend, exit here so that it's not\n    // preselected.\n    if (preSelectedCountries.length > 0 && !preSelectedCountries.includes(layer.id)) {\n      return;\n    }\n\n    // Dummy layer is attached to Map\n    dummyLayers[name].addTo(lMap);\n    // Real layer is attached to MarkerClusterGroup\n    cluster.addLayer(layer);\n  });\n\n  // Controls point the the dummy layers.\n  const countryControl = createControl('country', dummyLayers);\n  controls.country = countryControl;\n\n  // Add a mapping so that we can find the real layer alter.\n  for (const row in countryControl._layers) {\n    if (countryControl._layers[row]) {\n      leafletMeta[L.Util.stamp(countryControl._layers[row].layer)] = countryControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', overlay => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'country') {\n      return;\n    }\n\n    if (overlay.type === 'overlayadd') {\n      cluster.addLayer(countryLayers[index]);\n    } else {\n      cluster.removeLayer(countryLayers[index]);\n    }\n  });\n\n  return countryLayers;\n}\n\nfunction createTripLayers(tripCollection) {\n  const tripLayers = prepareLayers('trip', tripCollection, {onEachFeature: setTripLayerStyles});\n  if (preSelectedCountries.length === 0) {\n    _.forEach(tripLayers, layer => layer.addTo(lMap));\n  }\n\n  const tripControl = createControl('trip', tripLayers);\n  controls.trip = tripControl;\n\n  for (const row in tripControl._layers) {\n    if (tripControl._layers[row]) {\n      leafletMeta[L.Util.stamp(tripControl._layers[row].layer)] = tripControl._layers[row].name;\n    }\n  }\n\n  lMap.on('overlayadd overlayremove', overlay => {\n    const index = leafletMeta[L.Util.stamp(overlay.layer)];\n    if (overlay.layer.type !== 'trip') {\n      return;\n    }\n\n    const trip = tripCollection[index];\n    const countries = _.map(trip.properties.countries, 'name');\n    const control = controls.country;\n    const on = (overlay.type === 'overlayadd');\n\n    toggleControlCheckboxes(control, countries, on);\n  });\n\n  if (preSelectedTrips.length > 0) {\n    _.chain(tripLayers)\n      .filter(layer => !preSelectedTrips.includes(layer.id))\n      .forEach(layer => {\n        lMap.removeLayer(layer);\n      })\n      .value();\n\n    _.chain(tripLayers)\n      .filter(layer => preSelectedTrips.includes(layer.id))\n      .forEach(layer => {\n        lMap.removeLayer(layer);\n        lMap.addLayer(layer);\n      })\n      .value();\n  }\n}\n\nfunction init(data) {\n  // Issue XHR requests for the routes of all trips, but do it async while\n  // rendering regular markers.\n  let tripCollection = _.forEach(data.trips, trip => {\n    trip.promise = fetch(`/${trip.path}`);\n  });\n\n  // Remove the placeholder image as it gets displayed while tiles are\n  // fetched.\n  lMap.once('zoomstart', () => {\n    map.style.backgroundImage = 'none';\n  });\n\n  lMap.on('overlayadd overlayremove', _.debounce(event => {\n    if (event.layer.type && event.layer.type === 'country') {\n      const layers = cluster.getLayers();\n      if (layers.length === 0) {\n        return;\n      }\n\n      const bounds = new L.LatLngBounds();\n      for (let i = 0, l = layers.length; i < l; i++) {\n        bounds.extend(layers[i].getLatLng());\n      }\n\n      lMap.fitBounds(bounds);\n    }\n  }, 100));\n\n  // Create the country layers.\n  createCountryLayers(data.countries);\n  lMap.addControl(createSearchControl());\n\n  // Wait for all requests to finish\n  Promise.all(_.map(tripCollection, trip => {\n    return trip.promise\n      .then(data => data.json())\n      .catch(error => error);\n  })).then(responses => {\n    tripCollection = _.chain(tripCollection)\n      // Attach the features collected from the XHR request.\n      .forEach((trip, idx) => {\n        trip.features = responses[idx];\n      })\n      .keyBy(trip => trip.properties.name)\n      .value();\n\n    // Create the trip layers.\n    createTripLayers(tripCollection);\n\n    if (!controls.other) {\n      controls.other = L.control.layers(null, null, {collapsed: false}).addTo(lMap);\n      controls.other.addOverlay(cluster, 'Markers');\n    }\n  });\n}\n","// removed by extract-text-webpack-plugin","// removed by extract-text-webpack-plugin"],"sourceRoot":""}